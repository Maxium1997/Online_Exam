{% extends 'base.html' %}

{% load web_filters %}

{% block scripts %}
    <script type="text/javascript">
        var validContent = true;

        function content_valid(origin ,input) {
            var content_invalid = document.getElementById('content_invalid');

            if(!input.value){
                content_invalid.innerHTML = "<span style='color: red; font-size: 14px'>必填</span>";
                validContent = false;
            }
            else if(origin === input.value){
                content_invalid.innerHTML = "";
                validContent = false;
            }
            else {
                content_invalid.innerHTML = '<i style="color: limegreen" class="fa fa-check"></i>';
                validContent = true;
            }
        }

        function answer_valid() {
            var choices = document.getElementsByName('answer_choice');
            var answer_invalid = document.getElementById('answer_invalid');
            var checked = '';

            for(var _ = 0; _ < choices.length; _++){
                if(choices[_].checked === true){
                    checked = choices[_].value;
                    break;
                }
            }
            answer_invalid.innerHTML = checked + '~~~';
        }
    </script>
{% endblock %}

{% block path %}
    <a {% if request.user|has_perm:'TBManager' %}href="{% url 'tbmanager_question_list' %}">題庫管理員{% else %}href="{% url 'tboperator_question_list' %}">題目操作員{% endif %}</a>
    <a class="fa fa-angle-double-right fa-lg box"></a>
    <a href="">編輯試題</a>
{% endblock %}

{% block content %}
    <div class="edit_question">
        <form enctype="multipart/form-data" action="" method="post">
            <div class="title"><h1>Edit Questions.</h1></div>
            {% csrf_token %}
            <table>
                <tr>
                    <td class="col-md-2">題目</td>
                    <td class="col-md-5" style="padding-left: 10%">
                        {% if question.q_file %}
                            <audio controls preload="none">
                                <source src="{{ question.q_file }}" type="audio/mpeg">
                                Your browser does not support the audio tag.
                            </audio>
                        {% else %}
                            <textarea class="form-control" name="q_content" cols="55" rows="4" onkeyup="content_valid('{{ question.q_content }}' ,this)">{{ question.q_content }}</textarea>
                        {% endif %}
                    </td>
                    <td id="content_invalid" class="content_invalid"></td>
                </tr>

                {% for choice in question.choice_set.all %}
                <tr>
                    {% if forloop.counter == 1 %}
                        <td class="col-md-2" style="font-size: 20px">設定答案</td>
                    {% else %}
                        <td class="col-md-2"></td>
                    {% endif %}
                    <td class="col-md-5" style="padding-left: 10%"><input type="radio" name="answer_choice" value="{{ choice.id }}" onclick="answer_valid()">{{ choice }}</td>
                </tr>
                {% endfor %}
                <tr id="answer_invalid" class="answer_invalid"></tr>
            </table>

            <div class="btn">
                <button type="submit" id="submit" onclick="return confirm('確認更改此試題並通過審核？')">確認更改</button>
                <button type="button" onclick="self.location=document.referrer;">取消</button>
            </div>
        </form>

        <style>
            .edit_question .title h1{
                width: 30%;
                font-size: 28px;
                color: #FFFEF6;
                background-color: #4CCABD;
                padding-top: 10px;
                padding-bottom: 10px;
                padding-right: 15px;
                padding-left: 45px;
                text-align: center;
            }

            .edit_question table{
                position: relative;
                left: 20%;

                width: 60%;

                font-size: 20px;
            }
            .edit_question table td{
                padding: 4px;
                text-align: left;
            }
            .edit_question form input{
                padding: 6px;
            }
            .edit_question form textarea{
                font-size: 20px;
                width: 100%;
                height: 45%;
                padding: 10px;
            }

            .edit_question .btn{
                position: relative;
                top: 30px;
                left: 40%;
            }
        </style>
    </div>


{% endblock %}