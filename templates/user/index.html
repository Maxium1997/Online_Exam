{% extends 'new_base.html' %}

{% load web_filters %}

{% block scripts %}
    <script>
        $(document).ready(function() {
            $('.mdb-select').materialSelect();
        });
    </script>
{% endblock %}

{% block path %}
    <li class="breadcrumb-item active" aria-current="page">使用者列表</li>
{% endblock %}

{% block content %}
    <main class="user-list">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-12">
                    <!-- 搜尋 -->
                    <form class="form-inline md-form form-group-sm mt-0" method="get">
                    <input class="form-control" type="text" name="name" placeholder="Search" aria-label="Search">

                    <label class="mr-sm-2" for="inlineFormCustomSelect">Department.</label>
                    <select class="custom-select mr-sm-2" id="inlineFormCustomSelect" name="department">
                        <option value="" selected>All</option>
                        {% for department in departments %}
                            <option value="{{ department.id }}" {% if department.id == keywords.department.id %} selected {% endif %}>{{ department.name }}</option>
                        {% endfor %}
                    </select>


                    <label class="mr-sm-2" for="inlineFormCustomSelect">Squadron.</label>
                    <select class="custom-select mr-sm-2" id="inlineFormCustomSelect" name="squadron">
                        <option value="" selected>All</option>
                        {% for squadron in squadrons %}
                            <option value="{{ squadron.id }}" {% if squadron.id == keywords.squadron.id %} selected {% endif %}>{{ squadron.name }}</option>
                        {% endfor %}
                    </select>


                    <label class="mr-sm-2" for="inlineFormCustomSelect">Grade.</label>
                    <input class="form-control" type="number" name="grade" {% if keywords.grade %}value="{{ keywords.grade }}"{% endif %} placeholder="grade...">

                    <button class="btn btn-primary btn-group-justified" type="submit">
                        <i class="fa fa-search"></i>
                    </button>
                </form>
                </div>
            </div>

            <div class="row">
                <!--資料區塊-->
                <div class="col-lg-12 table-responsive-md">
                    <h2>User List</h2>
                    <table class="table table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th scope="col">帳號</th>
                                <th scope="col">姓名</th>
                                <th scope="col">身份</th>
                                <th scope="col">權限</th>
                                <th scope="col">最後登入時間</th>
                                <th scope="col">
                                    <div class="add">
                                        <button type="button" class="btn btn-secondary" onclick="window.location.href='{% url 'user_create' %}'"><i class="fa fa-plus"></i></button>
                                    </div>
                                </th>
                            </tr>
                        </thead>

                        <tbody>
                            {% if userList %}
                                {% for user in userList %}
                                    <tr class="align-center" style="cursor: pointer" onclick="window.location.href='{% url "view_profile" user.reg_id %}'">
                                        <td>{{ user.reg_id }}</td>

                                        <td>{{ user.name }}</td>

                                        <td>
                                            {% if user.identity %}
                                                {{ user.identity|readableIdentity }}
                                            {% else %}
                                                尚未設定
                                            {% endif %}
                                        </td>

                                        <td>
                                            {% if user|has_perms:privileges.SystemManager %}
                                                <span class="badge alert-danger">{{ privileges.SystemManager.value.1 }}</span>
                                            {% endif %}
                                            {% if user|has_perms:privileges.TestManager %}
                                                <span class="badge alert-warning">{{ privileges.TestManager.value.1 }}</span>
                                            {% endif %}
                                            {% if user|has_perms:privileges.TBManager %}
                                                <span class="badge badge-primary">{{ privileges.TBManager.value.1 }}</span>
                                            {% endif %}
                                            {% if user|has_perms:privileges.TBOperator %}
                                                <span class="badge alert-success">{{ privileges.TBOperator.value.1 }}</span>
                                            {% endif %}
                                            {% if user|has_perms:privileges.Viewer %}
                                                <span class="badge alert-info">{{ privileges.Viewer.value.1 }}</span>
                                            {% endif %}
                                            {% if user|has_perms:privileges.Testee %}
                                                <span class="badge alert-dark">{{ privileges.Testee.value.1 }}</span>
                                            {% endif %}
                                        </td>

                                        <td>{{ user.last_login|date:'H:i, Y/m/d' }}</td>

                                        <td>
                                            <a href="{% url 'user_edit' user.reg_id %}"><i class="fa fa-pencil-square-o"></i></a>
                                        </td>
                                    </tr>
                                {% endfor %}
                            {% else %}
                                <tr>
                                    <td>
                                        {% if query_content and not users %}
                                            找不到符合的條件「{{ query_content|readable_user_query_content }}」的使用者。
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <style>

        .user-list .table-responsive-md tr > td > a{
            display: none;
        }
        .user-list .table-responsive-md tr:hover > td > a{
            display: block;
        }
    </style>


{% endblock %}

{% block pagination %}
    <ul class="pagination justify-content-center">
        <li class="page-item"><a class="page-link" href="?page=1{% if query_content %}&{{ query_content }}{% endif %}"><i class="fa fa-angle-double-left"></i></a></li>

        <li class="page-item {% if not pros.has_previous %}disable{% endif %}">
            {% if pros.has_previous %}
                <a class="page-link" href="?page={{ pros.previous_page_number }}" tabindex="-1"><i class="fa fa-angle-left"></i></a>
            {% else %}
                <a class="page-link" href="javascript:void(0);"><i class="fa fa-angle-left"></i></a>
            {% endif %}
        </li>

        {% for page in paginator.page_range %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page }}{% if query_content %}&{{ query_content }}{% endif %}">{{ page }}</a>
            </li>
        {% endfor %}

        <li class="page-item {% if not userList.has_next %}disable{% endif %}">
            {% if userList.has_next %}
                <a class="page-link" href="?page={{ userList.next_page_number }}"><i class="fa fa-angle-right"></i></a>
            {% else %}
                <a class="page-link" href="javascript:void(0);"><i class="fa fa-angle-right"></i></a>
            {% endif %}
        </li>

        <li class="page-item"><a class="page-link" href="?page={{ userList.paginator.num_pages }}{% if query_content %}&{{ query_content }}{% endif %}"><i class="fa fa-angle-double-right"></i></a></li>
    </ul>
{% endblock %}
